task preprocess {
    def controlPlaneConf = file("control-plane.conf")
    def jobJson = file("job.json")
    def  _configTpl = file("templates/_config.tpl")

    inputs.files controlPlaneConf, jobJson
    outputs.file _configTpl

    doLast {
        jobJson.text.indent(6)

        _configTpl.text = """\
{{- /* this file is generated by gradle task `${it.name}`.
DON'T MODIFY IT!
 */ -}}
{{- define "configFileContent" -}}
${controlPlaneConf.text
                .replace('<JOBS_JSON_PLACEHOLDER>',
                        jobJson.text.indent(6)
        )}
{{- end -}}
"""
    }
}

